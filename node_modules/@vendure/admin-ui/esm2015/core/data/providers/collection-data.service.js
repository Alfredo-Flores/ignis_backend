import { pick } from '@vendure/common/lib/pick';
import { from } from 'rxjs';
import { bufferCount, concatMap } from 'rxjs/operators';
import { CREATE_COLLECTION, DELETE_COLLECTION, GET_COLLECTION, GET_COLLECTION_CONTENTS, GET_COLLECTION_FILTERS, GET_COLLECTION_LIST, MOVE_COLLECTION, PREVIEW_COLLECTION_CONTENTS, UPDATE_COLLECTION, } from '../definitions/collection-definitions';
export class CollectionDataService {
    constructor(baseDataService) {
        this.baseDataService = baseDataService;
    }
    getCollectionFilters() {
        return this.baseDataService.query(GET_COLLECTION_FILTERS);
    }
    getCollections(take = 10, skip = 0) {
        return this.baseDataService.query(GET_COLLECTION_LIST, {
            options: {
                take,
                skip,
            },
        });
    }
    getCollection(id) {
        return this.baseDataService.query(GET_COLLECTION, {
            id,
        });
    }
    createCollection(input) {
        return this.baseDataService.mutate(CREATE_COLLECTION, {
            input: pick(input, [
                'translations',
                'parentId',
                'assetIds',
                'featuredAssetId',
                'filters',
                'customFields',
            ]),
        });
    }
    updateCollection(input) {
        return this.baseDataService.mutate(UPDATE_COLLECTION, {
            input: pick(input, [
                'id',
                'isPrivate',
                'translations',
                'assetIds',
                'featuredAssetId',
                'filters',
                'customFields',
            ]),
        });
    }
    moveCollection(inputs) {
        return from(inputs).pipe(concatMap(input => this.baseDataService.mutate(MOVE_COLLECTION, { input })), bufferCount(inputs.length));
    }
    deleteCollection(id) {
        return this.baseDataService.mutate(DELETE_COLLECTION, {
            id,
        });
    }
    previewCollectionVariants(input, options) {
        return this.baseDataService.query(PREVIEW_COLLECTION_CONTENTS, { input, options });
    }
    getCollectionContents(id, take = 10, skip = 0, filterTerm) {
        const filter = filterTerm
            ? { name: { contains: filterTerm } }
            : undefined;
        return this.baseDataService.query(GET_COLLECTION_CONTENTS, {
            id,
            options: {
                skip,
                take,
                filter,
            },
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbi1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvcmUvc3JjL2RhdGEvcHJvdmlkZXJzL2NvbGxlY3Rpb24tZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFvQnhELE9BQU8sRUFDSCxpQkFBaUIsRUFDakIsaUJBQWlCLEVBQ2pCLGNBQWMsRUFDZCx1QkFBdUIsRUFDdkIsc0JBQXNCLEVBQ3RCLG1CQUFtQixFQUNuQixlQUFlLEVBQ2YsMkJBQTJCLEVBQzNCLGlCQUFpQixHQUNwQixNQUFNLHVDQUF1QyxDQUFDO0FBSS9DLE1BQU0sT0FBTyxxQkFBcUI7SUFDOUIsWUFBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBQUcsQ0FBQztJQUV4RCxvQkFBb0I7UUFDaEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBNkIsc0JBQXNCLENBQUMsQ0FBQztJQUMxRixDQUFDO0lBRUQsY0FBYyxDQUFDLE9BQWUsRUFBRSxFQUFFLE9BQWUsQ0FBQztRQUM5QyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUM3QixtQkFBbUIsRUFDbkI7WUFDSSxPQUFPLEVBQUU7Z0JBQ0wsSUFBSTtnQkFDSixJQUFJO2FBQ1A7U0FDSixDQUNKLENBQUM7SUFDTixDQUFDO0lBRUQsYUFBYSxDQUFDLEVBQVU7UUFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBK0MsY0FBYyxFQUFFO1lBQzVGLEVBQUU7U0FDTCxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsZ0JBQWdCLENBQUMsS0FBNEI7UUFDekMsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FDOUIsaUJBQWlCLEVBQ2pCO1lBQ0ksS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2YsY0FBYztnQkFDZCxVQUFVO2dCQUNWLFVBQVU7Z0JBQ1YsaUJBQWlCO2dCQUNqQixTQUFTO2dCQUNULGNBQWM7YUFDakIsQ0FBQztTQUNMLENBQ0osQ0FBQztJQUNOLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxLQUE0QjtRQUN6QyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUM5QixpQkFBaUIsRUFDakI7WUFDSSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDZixJQUFJO2dCQUNKLFdBQVc7Z0JBQ1gsY0FBYztnQkFDZCxVQUFVO2dCQUNWLGlCQUFpQjtnQkFDakIsU0FBUztnQkFDVCxjQUFjO2FBQ2pCLENBQUM7U0FDTCxDQUNKLENBQUM7SUFDTixDQUFDO0lBRUQsY0FBYyxDQUFDLE1BQTZCO1FBQ3hDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDcEIsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQ2QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQ3ZCLGVBQWUsRUFDZixFQUFFLEtBQUssRUFBRSxDQUNaLENBQ0osRUFDRCxXQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUM3QixDQUFDO0lBQ04sQ0FBQztJQUVELGdCQUFnQixDQUFDLEVBQVU7UUFDdkIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FDOUIsaUJBQWlCLEVBQ2pCO1lBQ0ksRUFBRTtTQUNMLENBQ0osQ0FBQztJQUNOLENBQUM7SUFFRCx5QkFBeUIsQ0FBQyxLQUFxQyxFQUFFLE9BQWtDO1FBQy9GLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBRy9CLDJCQUEyQixFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELHFCQUFxQixDQUFDLEVBQVUsRUFBRSxPQUFlLEVBQUUsRUFBRSxPQUFlLENBQUMsRUFBRSxVQUFtQjtRQUN0RixNQUFNLE1BQU0sR0FBRyxVQUFVO1lBQ3JCLENBQUMsQ0FBRSxFQUFFLElBQUksRUFBRSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsRUFBZ0M7WUFDbkUsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNoQixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUM3Qix1QkFBdUIsRUFDdkI7WUFDSSxFQUFFO1lBQ0YsT0FBTyxFQUFFO2dCQUNMLElBQUk7Z0JBQ0osSUFBSTtnQkFDSixNQUFNO2FBQ1Q7U0FDSixDQUNKLENBQUM7SUFDTixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwaWNrIH0gZnJvbSAnQHZlbmR1cmUvY29tbW9uL2xpYi9waWNrJztcclxuaW1wb3J0IHsgZnJvbSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBidWZmZXJDb3VudCwgY29uY2F0TWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHtcclxuICAgIENvbGxlY3Rpb25GaWx0ZXJQYXJhbWV0ZXIsXHJcbiAgICBDcmVhdGVDb2xsZWN0aW9uLFxyXG4gICAgQ3JlYXRlQ29sbGVjdGlvbklucHV0LFxyXG4gICAgRGVsZXRlQ29sbGVjdGlvbixcclxuICAgIEdldENvbGxlY3Rpb24sXHJcbiAgICBHZXRDb2xsZWN0aW9uQ29udGVudHMsXHJcbiAgICBHZXRDb2xsZWN0aW9uRmlsdGVycyxcclxuICAgIEdldENvbGxlY3Rpb25MaXN0LFxyXG4gICAgTW92ZUNvbGxlY3Rpb24sXHJcbiAgICBNb3ZlQ29sbGVjdGlvbklucHV0LFxyXG4gICAgUHJldmlld0NvbGxlY3Rpb25Db250ZW50c1F1ZXJ5LFxyXG4gICAgUHJldmlld0NvbGxlY3Rpb25Db250ZW50c1F1ZXJ5VmFyaWFibGVzLFxyXG4gICAgUHJldmlld0NvbGxlY3Rpb25WYXJpYW50c0lucHV0LFxyXG4gICAgUHJvZHVjdFZhcmlhbnRMaXN0T3B0aW9ucyxcclxuICAgIFVwZGF0ZUNvbGxlY3Rpb24sXHJcbiAgICBVcGRhdGVDb2xsZWN0aW9uSW5wdXQsXHJcbn0gZnJvbSAnLi4vLi4vY29tbW9uL2dlbmVyYXRlZC10eXBlcyc7XHJcbmltcG9ydCB7XHJcbiAgICBDUkVBVEVfQ09MTEVDVElPTixcclxuICAgIERFTEVURV9DT0xMRUNUSU9OLFxyXG4gICAgR0VUX0NPTExFQ1RJT04sXHJcbiAgICBHRVRfQ09MTEVDVElPTl9DT05URU5UUyxcclxuICAgIEdFVF9DT0xMRUNUSU9OX0ZJTFRFUlMsXHJcbiAgICBHRVRfQ09MTEVDVElPTl9MSVNULFxyXG4gICAgTU9WRV9DT0xMRUNUSU9OLFxyXG4gICAgUFJFVklFV19DT0xMRUNUSU9OX0NPTlRFTlRTLFxyXG4gICAgVVBEQVRFX0NPTExFQ1RJT04sXHJcbn0gZnJvbSAnLi4vZGVmaW5pdGlvbnMvY29sbGVjdGlvbi1kZWZpbml0aW9ucyc7XHJcblxyXG5pbXBvcnQgeyBCYXNlRGF0YVNlcnZpY2UgfSBmcm9tICcuL2Jhc2UtZGF0YS5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2xsZWN0aW9uRGF0YVNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBiYXNlRGF0YVNlcnZpY2U6IEJhc2VEYXRhU2VydmljZSkge31cclxuXHJcbiAgICBnZXRDb2xsZWN0aW9uRmlsdGVycygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0Q29sbGVjdGlvbkZpbHRlcnMuUXVlcnk+KEdFVF9DT0xMRUNUSU9OX0ZJTFRFUlMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbGxlY3Rpb25zKHRha2U6IG51bWJlciA9IDEwLCBza2lwOiBudW1iZXIgPSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldENvbGxlY3Rpb25MaXN0LlF1ZXJ5LCBHZXRDb2xsZWN0aW9uTGlzdC5WYXJpYWJsZXM+KFxyXG4gICAgICAgICAgICBHRVRfQ09MTEVDVElPTl9MSVNULFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFrZSxcclxuICAgICAgICAgICAgICAgICAgICBza2lwLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbGxlY3Rpb24oaWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRDb2xsZWN0aW9uLlF1ZXJ5LCBHZXRDb2xsZWN0aW9uLlZhcmlhYmxlcz4oR0VUX0NPTExFQ1RJT04sIHtcclxuICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29sbGVjdGlvbihpbnB1dDogQ3JlYXRlQ29sbGVjdGlvbklucHV0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxDcmVhdGVDb2xsZWN0aW9uLk11dGF0aW9uLCBDcmVhdGVDb2xsZWN0aW9uLlZhcmlhYmxlcz4oXHJcbiAgICAgICAgICAgIENSRUFURV9DT0xMRUNUSU9OLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dDogcGljayhpbnB1dCwgW1xyXG4gICAgICAgICAgICAgICAgICAgICd0cmFuc2xhdGlvbnMnLFxyXG4gICAgICAgICAgICAgICAgICAgICdwYXJlbnRJZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0SWRzJyxcclxuICAgICAgICAgICAgICAgICAgICAnZmVhdHVyZWRBc3NldElkJyxcclxuICAgICAgICAgICAgICAgICAgICAnZmlsdGVycycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2N1c3RvbUZpZWxkcycsXHJcbiAgICAgICAgICAgICAgICBdKSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUNvbGxlY3Rpb24oaW5wdXQ6IFVwZGF0ZUNvbGxlY3Rpb25JbnB1dCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8VXBkYXRlQ29sbGVjdGlvbi5NdXRhdGlvbiwgVXBkYXRlQ29sbGVjdGlvbi5WYXJpYWJsZXM+KFxyXG4gICAgICAgICAgICBVUERBVEVfQ09MTEVDVElPTixcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQ6IHBpY2soaW5wdXQsIFtcclxuICAgICAgICAgICAgICAgICAgICAnaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICdpc1ByaXZhdGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0cmFuc2xhdGlvbnMnLFxyXG4gICAgICAgICAgICAgICAgICAgICdhc3NldElkcycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZlYXR1cmVkQXNzZXRJZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZpbHRlcnMnLFxyXG4gICAgICAgICAgICAgICAgICAgICdjdXN0b21GaWVsZHMnLFxyXG4gICAgICAgICAgICAgICAgXSksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBtb3ZlQ29sbGVjdGlvbihpbnB1dHM6IE1vdmVDb2xsZWN0aW9uSW5wdXRbXSkge1xyXG4gICAgICAgIHJldHVybiBmcm9tKGlucHV0cykucGlwZShcclxuICAgICAgICAgICAgY29uY2F0TWFwKGlucHV0ID0+XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8TW92ZUNvbGxlY3Rpb24uTXV0YXRpb24sIE1vdmVDb2xsZWN0aW9uLlZhcmlhYmxlcz4oXHJcbiAgICAgICAgICAgICAgICAgICAgTU9WRV9DT0xMRUNUSU9OLFxyXG4gICAgICAgICAgICAgICAgICAgIHsgaW5wdXQgfSxcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgIGJ1ZmZlckNvdW50KGlucHV0cy5sZW5ndGgpLFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlQ29sbGVjdGlvbihpZDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVDb2xsZWN0aW9uLk11dGF0aW9uLCBEZWxldGVDb2xsZWN0aW9uLlZhcmlhYmxlcz4oXHJcbiAgICAgICAgICAgIERFTEVURV9DT0xMRUNUSU9OLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByZXZpZXdDb2xsZWN0aW9uVmFyaWFudHMoaW5wdXQ6IFByZXZpZXdDb2xsZWN0aW9uVmFyaWFudHNJbnB1dCwgb3B0aW9uczogUHJvZHVjdFZhcmlhbnRMaXN0T3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxcclxuICAgICAgICAgICAgUHJldmlld0NvbGxlY3Rpb25Db250ZW50c1F1ZXJ5LFxyXG4gICAgICAgICAgICBQcmV2aWV3Q29sbGVjdGlvbkNvbnRlbnRzUXVlcnlWYXJpYWJsZXNcclxuICAgICAgICA+KFBSRVZJRVdfQ09MTEVDVElPTl9DT05URU5UUywgeyBpbnB1dCwgb3B0aW9ucyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb2xsZWN0aW9uQ29udGVudHMoaWQ6IHN0cmluZywgdGFrZTogbnVtYmVyID0gMTAsIHNraXA6IG51bWJlciA9IDAsIGZpbHRlclRlcm0/OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBmaWx0ZXIgPSBmaWx0ZXJUZXJtXHJcbiAgICAgICAgICAgID8gKHsgbmFtZTogeyBjb250YWluczogZmlsdGVyVGVybSB9IH0gYXMgQ29sbGVjdGlvbkZpbHRlclBhcmFtZXRlcilcclxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldENvbGxlY3Rpb25Db250ZW50cy5RdWVyeSwgR2V0Q29sbGVjdGlvbkNvbnRlbnRzLlZhcmlhYmxlcz4oXHJcbiAgICAgICAgICAgIEdFVF9DT0xMRUNUSU9OX0NPTlRFTlRTLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICBza2lwLFxyXG4gICAgICAgICAgICAgICAgICAgIHRha2UsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==